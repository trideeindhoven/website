<!DOCTYPE html>
<html lang="nlen">

<head>

<meta charset="utf-8">
<title>CloudAware Technical Consultancy | Versleuteling</title>
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<link rel="apple-touch-icon" sizes="180x180" href='/website/apple-touch-icon.png'>
<link rel="icon" type="image/png" sizes="32x32" href='/website/favicon-32x32.png'>
<link rel="icon" type="image/png" sizes="16x16" href='/website/favicon-16x16.png'>
<link rel="manifest" href='/website/site.webmanifest'>

<link href='/website/css/fa6.min.css' rel="stylesheet" type="text/css">




<link rel="stylesheet" href="/website/css/style.min.30fe29d4292e6ad3dae600c3456384ad1c258ff0452424d6c252ac2fe32dbff5.css" />


<link href='/website/css/style.min.css' rel="stylesheet" type="text/css">
<link rel="stylesheet" href='/website/css/custom.css'>
<script defer type="text/javascript" src="/website/js/privacy-manager/config.js"></script>
<script defer type="text/javascript" src="/website/js/privacy-manager/klaro.js"></script>

<script>
  var _paq = window._paq = window._paq || [];
   
  _paq.push(['requireCookieConsent']);
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="https://app.cloudaware.eu/cloudtr/";
    _paq.push(['setTrackerUrl', u+'cloudtr']);
    _paq.push(['setSiteId', '1']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.async=true; g.src=u+'cloudtr.js'; s.parentNode.insertBefore(g,s);
  })();
</script>




<meta property="og:site_name" content="CloudAware Technical Consultancy" />
<meta property="og:title" content="Versleuteling | CloudAware Technical Consultancy" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://trideeindhoven.github.io/website/yealink/versleuteling/" />
<meta property="og:locale" content="nl" />
<meta name="twitter:card" content="summary_large_image">
<meta property="twitter:title" content="Versleuteling">



<meta property="og:image" content="https://trideeindhoven.github.io/website/img/yealink/pexels-george-becker-114741.jpg">


<meta name="description" content="Versleuteling" />
<meta property="og:description" content="Versleuteling" />
<meta property="twitter:description" content="Versleuteling" />


</head>

<body class="flex flex-col min-h-screen">
  <main class="flex-grow"><header>
    <div id="overlay">
        <ul class="text-center list-none text-white text-3xl">
            
            <li class="p-2">
                <a href="/website/services/">
                    <span>Services</span>
                </a>
            </li>
            
            <li class="p-2">
                <a href="/website/yealink/">
                    <span>Yealink</span>
                </a>
            </li>
            
            <li class="p-2">
                <a href="/website/support">
                    <span>Support</span>
                </a>
            </li>
            
            <li class="p-2">
                <a href="/website/about/">
                    <span>About</span>
                </a>
            </li>
            
            <li class="p-2">
                <a href="/website/contact/">
                    <span>Contact</span>
                </a>
            </li>
            
        </ul>
    </div>
    <nav class="flex items-center justify-between flex-wrap bg-opacity-100 p-8">
        <div class="flex items-center flex-shrink-0 text-xl text-grey-900 mr-6">
            <a href="https://trideeindhoven.github.io/website/"><img alt="CloudAware Logo"
                    class="h-14 mr-3" src="/website/img/logo/logo.svg"></a>
        </div>
        <div class="block lg:hidden">
            <div id="hamburgerbtn" class="flex cursor-pointer items-center w-14 h-10 py-2 rounded mopen">
                <span class="top"></span>
                <span class="middle"></span>
                <span class="bottom"></span>
            </div>
        </div>
        <div class="hidden w-full block flex-grow lg:flex lg:items-center lg:w-auto" id="mobileMenu">
            <div class="text-lg lg:flex-grow">
            </div>
            <div class="text-lg">
                
                <a href="/website/services/"
                    class="duration-200 block mt-4 lg:inline-block lg:mt-0 text-black hover:opacity-60 mr-8">
                    Services
                </a>
                
                <a href="/website/yealink/"
                    class="duration-200 block mt-4 lg:inline-block lg:mt-0 text-black hover:opacity-60 mr-8">
                    Yealink
                </a>
                
                <a href="/website/support"
                    class="duration-200 block mt-4 lg:inline-block lg:mt-0 text-black hover:opacity-60 mr-8">
                    Support
                </a>
                
                <a href="/website/about/"
                    class="duration-200 block mt-4 lg:inline-block lg:mt-0 text-black hover:opacity-60 mr-8">
                    About
                </a>
                
                <a href="/website/contact/"
                    class="duration-200 block mt-4 lg:inline-block lg:mt-0 text-black hover:opacity-60 mr-8">
                    Contact
                </a>
                
            </div>
        </div>
    </nav>
</header><div class="scroll-top rounded-full">
      <span class="icon-keyboard_arrow_up text-2xl"></span>
    </div>
<div class="mx-auto my-10 max-w-6xl">
  <div class="mx-3 col-span-3 lg:col-span-2 px-2">
    <h1 class="title text-5xl mb-4">Versleuteling</h1>
    <div class="content prose md:prose-lg lg:prose-xl max-w-none py-1"><p>De aanleiding van dit onderzoek waren enkele zaken in de versleuteling in het provisioning proces die ik niet goed
begreep. Ik kon toen niet vermoeden dat ik hier 2 jaar later nog steeds ee bezig zou zijn.</p>
<p>Zoals in de inleiding uitgelegd is provisioning het systeem wat gebruikt wordt om configuratie bestanden veilig te
transporteren van een configuratieserver naar een systeem. Dit systeem kan een VoIP telefoon zijn, maar hetzelfde geldt
ook voor b.v. videobars.</p>
<p>In deze provisioning bestanden staan zaken als:</p>
<ul>
<li>gebruikersnaam</li>
<li>wachtwoord</li>
<li>voipserver</li>
<li>nummerherkenning</li>
</ul>
<p>Dit zijn dus zeer gevoelige data en in veel gevallen ook persoonsgegevens zoals gedefinieerd in AVG wetgeving. Het
privé houden van deze data tijdens transport over het internet is daarom van groot belang.<br>
Tijdens het bouwen van een provisioning systeem voor Yealink systemen wilde ik uiteraard een systeem bouwen wat
compatible was met de systemen van Yealink zelf. Helaas had ik hiervoor allerlei geheime informatie nodig, zoals
welke versleuteling wordt er gebruikt en natuurlijk ook: welke sleutel wordt er gebruikt. Uiteraard ging ik er niet van
uit dat ik deze informatie ging krijgen, dus ben ik op het internet op zoek gegaan naar manieren om een zo
compatibel mogelijk systeem te bouwen. Hierbij kwam ik een persoon tegen die mij niet alleen kon vertellen welke
versleuteling Yealink gebruikte, maar zelfs welke sleutel Yealink gebruikte. Het vroegst waar ik deze gelekte
sleutel kon terug vinden was 2014. Met deze gegevens was het een koud kunstje
om een provisioning systeem te bouwen wat 100% compatibel was met de Yealink systemen. Maar echt goed voelde dit
natuurlijk niet: Als ik deze gegevens had, wie dan nog meer?</p>
<p>Dus ik schrijf een email aan de Nederlandse distributeur van Yealink, Lydis, op 28 juli 2022:
<em>&ldquo;We hebben de firmware van Lydis bekeken en we zien dat de provisioning sleutel zelf versleuteld is met private key
EKs35XacP6eybA25 Aangezien deze hard coded is, lijkt ons dit een reëel risico. Welke mogelijke oplossing kan Lydis
(samen met Yealink?) ons bieden om dit risico weg te nemen?&rdquo;</em></p>
<p>Ik krijg een dag later een antwoord van een &ldquo;support manager&rdquo; van Lydis:
<em>&ldquo;We hebben vanuit verschillende onderzoeken door gerenommeerde partijen vastgesteld dat Yealink een veilig product op
de markt zet. Zowel SISO afdelingen van onder andere financiële instellingen als gemeentelijke en overheidsinstellingen
bevestigen dit.&rdquo;</em><br>
Het is mij nooit helemaal duidelijk geworden wat 
<a target="_blank" href="https://nl.wikipedia.org/wiki/SISO">bibliotheken</a> <i class="fa fa-external-link"></i>

met deze vraag te maken hebben, maar deze reactie nadat iemand je jouw eigen private key emailt geeft niet bijzonder
veel vertrouwen.</p>
<p>Maar het is altijd een goed idee om er van uit te gaan dat je zelf iets over het hoofd ziet en dus stel ik een aantal
opvolgvragen. De antwoorden op deze vragen blijken een bron te zijn voor maanden onderzoek.:</p>
<ul>
<li>Allereerst stuurt de <em>support manager</em> mij een GDPR certificaat op. Nu hoor ik de oplettende lezer hier meteen uit
zijn of haar stoel opveren. En uiteraard had ik hier ook vragen over. Zo veel vragen dat hier een uitgebreid artikel
voor ga schrijven in deze serie.</li>
<li>Vervolgens krijg ik een &ldquo;Remediation Report&rdquo; opgestuurd van de Yealink Cloud Services. Het is de volledige versie van
de samenvatting van de NetSPI testen die ook op de website van Yealink staan. Daar waar de (openbare) samenvatting
redelijk positief is, is het volledige rapport dat&hellip;niet. Hier later meer over in een vervolg publicatie!</li>
<li>Tijdens een Teams meeting wordt ik geïnformeerd dat de nieuwe Encryption Tool met RSA versleuteling werkt. Yealink
geeft aan dat ze pas 6 jaar na het uitlekken van de AES sleutel hiertoe hebben besloten.</li>
<li>En tot slot krijg ik een screenshot opgestuurd van de nieuwe Yealink Configuration Encryption Tool.</li>
</ul>
<img src="https://trideeindhoven.github.io/website/img/yealink/encryption_tool_1.jpg" alt="Yealink Configuration Encryption Tool">

<p>Hier vallen een aantal zaken op:</p>
<ul>
<li>Er is een &ldquo;compatibility mode&rdquo; en ik vermoed dat het hier gaat om een AES-only modus.</li>
<li>Ook in RSA mode moet een AES type ingegeven worden.</li>
<li>het RSA Model staat op &ldquo;default&rdquo;</li>
<li>En het is blijkbaar mogelijk om een AES (?) sleutel automatisch te genereren.</li>
</ul>
<p>Het is duidelijk dat ik even moet gaan proberen te begrijpen hoe deze nieuwe Encryption Tool in elkaar zit en ik kom
tot de volgende conclusie:</p>
<ul>
<li>Yealink heeft de &ldquo;Default&rdquo; AES sleutel nog steeds in gebruik, maar dan alleen in &ldquo;Compatibility Mode&rdquo;. Op het moment
dat ik deze modus kies, krijg ik geen melding dat deze mogelijk onveilig is.</li>
<li>In RSA Mode wordt het configuratie bestand nog steeds met AES versleuteld. Echter de sleutel voor het versleutelen is
nu niet meer hetzelfde voor alle gebruikers (wat goed is).</li>
<li>Een VoIP telefoon die nu een bestand ophaalt kan nu echter onmogelijk weten wat de AES sleutel is om het bestand te
lezen. De oplossing die Yealink hier voor gekozen heeft is: voeg de AES sleutel toe gaan het configuratie bestand.</li>
<li>De AES sleutel wordt niet plain-text toegevoegd aan het bestand, maar wordt eerst met RSA versleuteling versleuteld.</li>
<li>Helaas besluit Yealink om deze super geheime RSA sleutel mee te leveren als een &ldquo;.pem&rdquo; bestand. Dit maakt het
ontsleutelen van de AES sleutel triviaal en dus ook het ontsleutelen van de rest van het bestand.</li>
</ul>
<p>Ik heb inmiddels het gevoel dat ik ook dit nieuwe systeem redelijk goed begrijp. En aangezien ik mij niet prettig voel
bij het draaien van binary files waar ik niet precies weet wat er in zit besluit ik de hele Encryption Tool open
source na te bouwen. Ik bouw daarom de tool na in python incl. een GUI. Ook zorg ik er voor dat er een
&ldquo;yealinkdecryption.py&rdquo; tool bij zit die als input een versleuteld bestand neemt en als output de AES sleutel en het
ontsleutelde bestand. Ik besluit het op 
<a target="_blank" href="https://github.com/gitaware/yealink-encryption">github</a> <i class="fa fa-external-link"></i>

te zetten, maar voorlopig als private repository aangezien het met deze software mogelijk is om geheime bestanden
te ontsleutelen.
&lt;TODO: fixen van image link in README op github&gt;</p>
<p>Nu email ik opnieuw met de &ldquo;support manager&rdquo; welke nu de &ldquo;Technisch directeur&rdquo; van Lydis blijkt te zijn. Ik stel dat ik
denk dat de versleuteling ernstig stuk is en dat Lydis dit waarschijnlijk met grote spoed aan Yealink moet gaan melden.
Ook vraag ik hem op 27 september 2022 om mij een versleuteld bestand te sturen, zodat ik kan zien of mijn
decryptie-tool inderdaad werkt. Op 30 september reageert hij terug met een versleuteld bestand voor een T48S. Ik reageer
dezelfde dag terug:<br>
*&ldquo;Mijn vermoeden is dus correct. De bestanden zijn nog steeds goed leesbaar, wellicht wel beter.<br>
Om meteen even met de deur in huis te vallen:<br>
De AES sleutel is: 33j503whh7bPK0zz0Kq3KwP00wKqbW3h<br>
Het config bestand is:<br>
#!version:1.0.0.1</p>
<p>static.lang.gui = German<br>
lang.gui = German</p>
<p>Laten we hier volgende week contact over hebben, want de implicaties hiervan zijn natuurlijk verstrekkend.&rdquo;*</p>
<p>De technisch directeur beseft waarschijnlijk toch wel dat dit niet het standaard &ldquo;ik ben een 1337 h4x0r&rdquo; mailtje is
en hij reageert die maandag meteen terug met <em>&ldquo;Zou je bijgevoegd bestand ook kunnen bekijken?&rdquo;</em> Bij het mailtje is een
nieuw versleuteld bestand toegevoegd. Vreemd genoeg struikelt mijn ontsleutel-software over dit bestand. Maar een korte
zoektocht naar de reden hiervan laat zien dat er een line-ending verschil is met het vorige bestand. De reden hiervan
kunnen we natuurlijk alleen maar over speculeren, maar het neemt niet weg dat ik diezelfde ochtend hem een email stuur:<br>
*&ldquo;Om maar met de deur in huis te vallen:</p>
<p>[jhermans@localhost yealink-encryption]$ ./yealinkdecryption.py -i y000000000065.cfg<br>
INFO: using RSA mode<br>
AES key found: 303wlbKBenhhHwpFzzj00QfwhwzbyKhp<br>
Decrypting provisiong file&hellip;</p>
<p>#!version:1.0.0.1<br>
static.lang.gui = French<br>
lang.gui = French</p>
<p>Dit is natuurlijk zeer slecht nieuws en zal ook zeer zeker in onze publicatie worden getoond. Ik wil Lydis nogmaals
de kans tot wederhoor bieden. Als jullie hier gebruik van willen maken stel ik voor dat we ook mensen van Yealink in
deze meeting plaatsen, want dit is een wereldwijd probleem.<br>
Ik hoor graag een voorstel voor een datum/tijd wanneer deze meeting kan plaatsvinden indien jullie gebruik willen
maken van deze mogelijkheid. Ik vind het ook geen probleem om hiervoor langs te komen op jullie kantoor.&rdquo;*</p>
<p>Hij reageert binnen 10 minuten met een (heel correct) <em>&ldquo;Ik ga dit verder met Yealink bespreken en maak graag gebruik
van de mogelijkheid hier een meeting over te plannen. Ik verwacht een meeting ergens in volgende week te kunnen
plannen omdat China deze week gesloten is. &ldquo;</em><br>
en later die dag met:
<em>&ldquo;Zou je bijgevoegd bestand ook kunnen testen.&rdquo;</em>
&lt;TODO: Zijlstra bestanden ter download aanbieden&gt;</p>
<p>Dit keer levert hij echter een bestand waar het &ldquo;key_ciphertext&rdquo; helemaal is verdwenen. Ik vraag hem waarom mijn
telefoon dit bestand niet kan gebruiken als geldig provisioniong document en hij geeft aan dat zij wat andere
instellingen in de provisioningtool hebben gebruikt. Als ik dan vraag of hij een lege sleutel oid heeft gebruikt omdat
er geen (versleutelde) AES sleutel in het document staat reageert hij dat <em>&ldquo;Waarom de key_ciphertext in het bestand
dan leeg is, is ons nu zo even niet bekend.&rdquo;</em><br>
Ik reageert met dat ALS dit een geldig provisioning document is (en Lydis beweert dat het dat is) dat &ldquo;er een geheime
key4a is die in elke telefoon meegeleverd wordt (backdoor).&rdquo;<br>
Er volgt een serie aan meetings met Yealink zowel via Teams als physiek in Almere. Het leidt er toe dat de encryption
Tool (en dus ook Clouddienst) van Yealink wordt aangepast. Het is niet meer mogelijk om het &ldquo;Default RSA Model&rdquo; te
gebruiken, waardoor de gelekte RSA private key ook niet meer gebruikt kan worden voor nieuwe deployments.</p>
<h1 id="ecb">ECB</h1>
<p>Laten we dan ook nog even kijken naar het soort versleuteling die Yealink gebruikt in hun laatste versie van hun
Encryption Tool. Zoals in mijn 
<a target="_blank" href="https://github.com/gitaware/yealink-encryption">open source</a> <i class="fa fa-external-link"></i>
 versie
van hun Encrytpion Tool te zien is gebruikt Yealink AES-ECB versleuteling. Voor de crypto-enthousiastelingen onder de
lezers moet er nu toch wel een glimlach op het gezicht verschijnen. ECB is namelijk een encryptie modus welke al jaren
als onveilig gezien wordt.</p>
<p>ECB AES</p>
<p><img src="https://trideeindhoven.github.io/website/img/yealink/ecb/Yealink_Logo.png" alt="Screenshot website CloudAware">

<img src="https://trideeindhoven.github.io/website/img/yealink/ecb/Yealink_Logo_ecb.png" alt="Screenshot website CloudAware">
</p>
<p>AES versleuteling
AES TUX
al vroeg gelekt
RSA sleutel ook gelekt
zie presentatie, maar basically levert Lydis tech dir. zelf 3 voorbeeld bestanden aan</p>
<p>Ook voor Teams</p></div>
  </div>
</div>

  </main><footer class="bg-tlgray-100">
  
  <script src='/website/js/clipboard.min.js'></script>
  <script src='/website/js/highlight.min.js'></script>
  <script src='/website/js/highlightjs-line-numbers.min.js'></script>
  <script src='/website/js/sweetalert2.min.js'></script>
  <script>
    hljs.initHighlightingOnLoad();
    hljs.initLineNumbersOnLoad();
    new ClipboardJS('.url');

    function OnClickURL() {
      Swal.fire({
        icon: 'success',
        title: 'Copied!',
        text: 'Copied the URL and title.'
      })
    }
  </script>
  
  <script>
    function toggleNav() {
      var hamburger = document.getElementById("hamburgerbtn");
      var overlay = document.getElementById("overlay");
      var body = document.body;

      hamburger.addEventListener("click", function () {
        overlay.classList.toggle("open");
        hamburger.classList.toggle("is-open");
        body.classList.toggle("scroll-lock");
      });
    }
    toggleNav();

    document.querySelector('.scroll-top').addEventListener('click', () => {
      document.documentElement.scrollTop = 0;
    });
  </script>
  
  <link href='/website/css/webfonts.min.css' rel="stylesheet" />
  
  <div class="flex items-center justify-between flex-wrap bg-gray-800 p-8 text-white">
    <div class="items-center text-xl text-grey-900 mr-6">
      CloudAware Technical Consultancy
    </div>
    <div class="w-full block flex-grow lg:flex lg:items-center lg:w-auto" id="mobileMenu">
      <div class="text-lg lg:flex-grow">
      </div>
      <div class="flex flex-row items-center text-lg">
        
        <a href="/website/" class="block mt-4 lg:inline-block lg:mt-0 text-gray-300 hover:text-white mr-8">
          
          Home
          
        </a>
        
        <a href="https://github.com/gitaware" class="block mt-4 lg:inline-block lg:mt-0 text-gray-300 hover:text-white mr-8">
          
          <i class='icon-github text-2xl'></i>
          
        </a>
        
      </div>
    </div>
  </div>
  <div class="copy pl-8 py-5 bg-tlgray-700 text-white text-md">
    &copy; CloudAware Technical Consultancy 2024 All Rights Reserved.
  </div>
</footer>
</body>

</html>