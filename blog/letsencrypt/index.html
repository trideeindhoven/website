<!DOCTYPE html>
<html lang="nl">

<head>

<meta charset="utf-8">
<title>CloudAware Technical Consultancy | Let&#39;s encrypt intermediate certificates</title>
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<link rel="apple-touch-icon" sizes="180x180" href='/website/apple-touch-icon.png'>
<link rel="icon" type="image/png" sizes="32x32" href='/website/favicon-32x32.png'>
<link rel="icon" type="image/png" sizes="16x16" href='/website/favicon-16x16.png'>
<link rel="manifest" href='/website/site.webmanifest'>

<link href='/website/css/fa6.min.css' rel="stylesheet" type="text/css">




<link rel="stylesheet" href="/website/css/style.min.77906017340b15ad69f27f2cd27f0833d0e78a75185c356924d7a17bf623e6fd.css" />


<link href='/website/css/style.min.css' rel="stylesheet" type="text/css">
<link rel="stylesheet" href='/website/css/custom.css'>
<script defer type="text/javascript" src="/website/js/privacy-manager/config.js"></script>
<script defer type="text/javascript" src="/website/js/privacy-manager/klaro.js"></script>

<script>
  var _paq = window._paq = window._paq || [];
   
  _paq.push(['requireCookieConsent']);
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="https://app.cloudaware.eu/cloudtr/";
    _paq.push(['setTrackerUrl', u+'cloudtr']);
    _paq.push(['setSiteId', '1']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.async=true; g.src=u+'cloudtr.js'; s.parentNode.insertBefore(g,s);
  })();
</script>



<meta property="og:title" content="CloudAware Technical Consultancy | Let&#39;s encrypt intermediate certificates" />




<meta name="description" content="CloudAware">
<meta property="og:title" content=" | " />
<meta property="og:site_name" content="CloudAware Technical Consultancy">
<meta property="og:description" content="CloudAware">
<meta property="og:url" content="https://trideeindhoven.github.io/website/blog/letsencrypt/">
<meta property="og:type" content="article">
<meta property="og:locale" content="">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@tech_chiba">

<link rel="canonical" href="https://trideeindhoven.github.io/website/blog/letsencrypt/">

<meta name="twitter:description" content="CloudAware">
<meta property="article:published_time" content="2024-06-26T00:00:00&#43;00:00">
<meta property="article:updated_time" content="2024-06-26T00:00:00&#43;00:00">





    
<meta property="og:image" content="https://trideeindhoven.github.io/website/img/blog/pexels-markus-winkler-1430818-19856610.jpg">
    


<meta name="twitter:title" content="Let&#39;s encrypt intermediate certificates">
<link rel="preload" href='/css/sweetalert2.min.css' as="style"
    onload="this.onload=null;this.rel='stylesheet'">

</head>

<body class="flex flex-col min-h-screen">
  <main class="flex-grow"><header>
    <div id="overlay">
        <ul class="text-center list-none text-white text-3xl">
            
            <li class="p-2">
                <a href="/website/blog/">
                    <span>Blog</span>
                </a>
            </li>
            
            <li class="p-2">
                <a href="/website/support">
                    <span>Support</span>
                </a>
            </li>
            
            <li class="p-2">
                <a href="/website/about/">
                    <span>Over</span>
                </a>
            </li>
            
            <li class="p-2">
                <a href="/website/spreker/">
                    <span>Spreker</span>
                </a>
            </li>
            
            <li class="p-2">
                <a href="/website/contact/">
                    <span>Contact</span>
                </a>
            </li>
            
        </ul>
    </div>
    <nav class="flex items-center justify-between flex-wrap bg-opacity-100 p-8">
        <div class="flex items-center flex-shrink-0 text-xl text-grey-900 mr-6">
            <a href="https://trideeindhoven.github.io/website/"><img alt="CloudAware Logo"
                    class="h-14 mr-3" src="/website/img/logo/cloudaware.png"></a>
        </div>
        <div class="block lg:hidden">
            <div id="hamburgerbtn" class="flex cursor-pointer items-center w-14 h-10 py-2 rounded mopen">
                <span class="top"></span>
                <span class="middle"></span>
                <span class="bottom"></span>
            </div>
        </div>
        <div class="hidden w-full block flex-grow lg:flex lg:items-center lg:w-auto" id="mobileMenu">
            <div class="text-lg lg:flex-grow">
            </div>
            <div class="text-lg">
                
                <a href="/website/blog/"
                    class="duration-200 block mt-4 lg:inline-block lg:mt-0 text-black hover:opacity-60 mr-8">
                    Blog
                </a>
                
                <a href="/website/support"
                    class="duration-200 block mt-4 lg:inline-block lg:mt-0 text-black hover:opacity-60 mr-8">
                    Support
                </a>
                
                <a href="/website/about/"
                    class="duration-200 block mt-4 lg:inline-block lg:mt-0 text-black hover:opacity-60 mr-8">
                    Over
                </a>
                
                <a href="/website/spreker/"
                    class="duration-200 block mt-4 lg:inline-block lg:mt-0 text-black hover:opacity-60 mr-8">
                    Spreker
                </a>
                
                <a href="/website/contact/"
                    class="duration-200 block mt-4 lg:inline-block lg:mt-0 text-black hover:opacity-60 mr-8">
                    Contact
                </a>
                
            </div>
        </div>
    </nav>
</header><div class="scroll-top rounded-full">
      <span class="icon-keyboard_arrow_up text-2xl"></span>
    </div>
<div class="mx-auto my-10 max-w-6xl">
    <div class="mx-3 col-span-3 lg:col-span-2 px-2">
        <h1 class="title text-5xl font-bold mb-3">Let&#39;s encrypt intermediate certificates</h1>
        <section class="mb-4 text-lg">
            <h4 id="date" class="flex flex-row items-center"><span class="icon-access_time text-2xl mr-2"></span>
                2024/06/26 </h4>
            
            <h4 class="flex flex-row items-center"><span class="icon-person text-2xl mr-2"></span>Jeroen Hermans
            </h4>
            
            
        </section>
        Translations of this article:<br />

        <a href="https://cloudaware-eu.translate.goog/website/blog/letsencrypt/?_x_tr_sl=nl&_x_tr_tl=en&_x_tr_hl=nl&_x_tr_pto=wapp"><img alt="EN" src="/website/img/uxwing/united-kingdom-flag-icon.svg" style="margin-top:5px;margin-bottom:5px;width:50px;display: inline;"></a>
        <a href="https://cloudaware-eu.translate.goog/website/blog/letsencrypt/?_x_tr_sl=nl&_x_tr_tl=de&_x_tr_hl=nl&_x_tr_pto=wapp"><img alt="EN" src="/website/img/uxwing/germany-flag-icon.svg" style="margin-top:5px;margin-bottom:5px;width:50px;display: inline;"></a>
        <a href="https://cloudaware-eu.translate.goog/website/blog/letsencrypt/?_x_tr_sl=nl&_x_tr_tl=fr&_x_tr_hl=nl&_x_tr_pto=wapp"><img alt="EN" src="/website/img/uxwing/france-flag-icon.svg" style="margin-top:5px;margin-bottom:5px;width:50px;display: inline;"></a>

        
        <img class="my-4" src="https://trideeindhoven.github.io/website/img/blog/pexels-markus-winkler-1430818-19856610.jpg">
        
        <div class="content prose md:prose-lg lg:prose-xl max-w-none py-1"><p>Ik werd vorige week door een klant bij een probleem met hun certificate chain geroepen. Zij gebruiken Let&rsquo;s encrypt certificaten
en het bleek dat de certificate chain niet meer in orde was. Hoewel dit probleem in een uurtje geanalyseerd en opgelost was,
is het wellicht toch interessant om hier even over te berichten.</p>
<p>Laten we eerst even kijken naar wat Let&rsquo;s Encrypt is en hoe het werkt.<br>
Let&rsquo;s Encrypt is een dienst waarmee het mogelijk is om kostenloos Transport Layer Security (TLS) certificaten aan te
vragen voor webservers en emailservers. Deze
dienst is opgezet door de 
<a target="_blank" href="https://www.abetterinternet.org/">Internet Security Research Group (ISRG)</a> <i class="fa fa-external-link"></i>
. De ISRG
zet zich in voor een &ldquo;secure and privacy-respecting world&rdquo; in het digitale domein. Zij doen heel veel mooie zaken en overweeg
dan ook om een kleine donatie te doen aan deze organisatie.<br>
De organisatie heeft boardmembers van grote organisaties zoals Mozilla, Cisco, EFF en Amazon. Vervolgens hebben zij alle grote partijen
met een eigen certificate trust store zo ver gekregen om hun eigen self-signed certificate toe te voegen in hun trust store.
Nu zijn dit niet heel veel partijen die zo&rsquo;n trust store beheren, maar het zijn wel heel grote partijen zoals Microsoft, Apple,
Mozilla, maar ook Linux distributie makers zoals Red Hat. ISRG heeft twee van deze root certificates: X1 en X2. Alle certificaten
welke door deze certificaten ondertekent worden zullen nu vertrouwd worden in je browser.</p>
<img src="https://trideeindhoven.github.io/website/img/blog/20240629_mozilla_trust_store.png" alt="Mozilla trust store"  >

<p>ISRG heeft er echter voor gekozen om geen certificaten uit te geven met deze X1 en X2 certificaten, maar om hier nog een &ldquo;tussen&rdquo;
certificaat tussen te plaatsen. Deze intermediate certificaten van ISRG zijn R10, R11, E5 en E6.
De reden dat ISRG uitgegeven certificaten niet direct met de twee root certificaten X1 en X2 ondertekent kom ik zo op terug.</p>
<p>Dit betekent dat een certificaat voor domein.nl een keten aan certificaten heeft. Elk certificaat in de keten hoort vertrouwd
te zijn voordat een website een &ldquo;slotje&rdquo; laat zien in de browser. Voor cloudaware.eu ziet dit (op dit moment) dan als volgt uit:
ISRG X1 -&gt; ISRG E5 -&gt; cloudaware.eu</p>
<img src="https://trideeindhoven.github.io/website/img/blog/20240629_ssllabs_cloudaware.eu.png" alt="cloudaware.eu certificate chain"  >

<p>Het eerste certificaat X1 is geïnstalleerd op je computer via een van de trust stores en is dus vertrouwd.<br>
Het E5 certificaat is ondertekend door het X1 certificaat en dus ook vertrouwd. Het cloudaware.eu certificaat is vertrouwd,
omdat het ondertekend is door het E5 certificaat.<br>
Deze keten heet de &ldquo;certificate chain&rdquo;. Elke stap in deze keten hoort &ldquo;vertrouwd&rdquo; te zijn. &ldquo;Vertrouwd&rdquo; betekent dat dat
certificaat aan een aantal zaken voldoet:</p>
<ul>
<li>huidige datum is niet voor de &ldquo;Not Before&rdquo; datum</li>
<li>huidige datum is niet na de &ldquo;Not After&rdquo; datum</li>
<li>het certificaat is geïnstalleerd in de certificate store van de computer OF is ondertekend door een vertrouwd certificaat in de keten.</li>
<li>het domein in het certificaat komt overeen met de website URL. Dit gaat soms mis als iemand alleen domein.nl aanvraagt en de website ook op <a href="https://www.domein.nl">www.domein.nl</a> bereikbaar moet zijn</li>
</ul>
<p>Er zijn nog andere voorwaarden waar een certificaat aan moet voldoen, maar dit zijn de belangrijkste.<br>
Zelf de certificate chain van een website testen (en nog veel meer) kan kostenloos op de website van

<a target="_blank" href="https://www.ssllabs.com/ssltest/">Qualys</a> <i class="fa fa-external-link"></i>
.</p>
<p>Nu hoor ik jullie sommigen van jullie al denken: E5? Het is toch R3? En dit is correct. Tot voor kort was het meest gebruikte intermediate
certicate van Let&rsquo;s Encrypt R3. Dit R3 certificaat was in gebruik sinds september 2020, maar verloopt in september 2025 en het
is daarom nodig om voor die tijd alle nieuwe Let&rsquo;s Encrypt certificaten te gaan ondertekenen met een nieuw intermediate certificate.
En dat is het E5 (of R10, R11, E6) certificaat geworden. En dat was ook exact wat was misgegaan bij de klant. De certificate chain bevatte nog
steeds het R3 certificaat, terwijl het domein.nl certificaat was ondertekend door E5. Het nieuwe E5 certificaat (en de
andere intermediate certificaten) is geldig tot maart
2027, dus over niet al te lange tijd moeten we weer goed gaan opletten dat de certificaat keten klopt.<br>
Uiteraard is het mogelijk om Let&rsquo;s Encrypt automatisch een correcte certificaat keten te laten genereren, maar in dit specifieke
geval was er voor gekozen om het intermediate certificate vast te configureren.</p>
<p>Laten we het even kort hebben over de term TLS. Sommigen van jullie denken wellicht: &ldquo;Wacht eens even. Dit heet toch SSL?&rdquo;.
Dat is &ldquo;soort van&rdquo; correct. Secure Socket Layer (SSL) is de voorloper van TLS. Inmiddels gebruiken we al jaren geen SSL meer, maar
uitsluitend de opvolger TLS. De term SSL is echter zo ingeburgerd dat deze term nog vaak gebruikt wordt als we het over
TLS hebben.</p>
<p>Dan nog even over de intermediate certificates. Waarom niet gewoon het root certificaat (X1 of X2) gebruiken om certificaten
uit te geven. Dit reduceert de lengte van de certificaat keten en maakt e.a. eenvoudiger. Er is echter een probleem met deze oplossing.
Als het root certificaat alle certificaten gaat ondertekenen, dan is het ook nodig om de private key van dit root certificaat
elke keer te gebruiken voor de ondertekening. De kans van het uitlekken van deze key wordt hierdoor groter dan handig. Dit
is exact de situatie die is ontstaan bij het beruchte incident met DigiNotar. Doordat het root certificaat X1 en X2 geïnstalleerd is
in de trust stores van deze grote partijen is het ook lastig(er) om deze root-certificaten weer in te trekken en/of te vervangen.
Door eens in de paar jaar een nieuw intermediate certificate te maken is het niet meer nodig om voor elk uitgegeven certificaat
de gevoelige private key van het root certificate te gebruiken.<br>
Bovendien is het mogelijk om intermediate certificates in te trekken aangezien deze niet in de trust-store geïnstalleerd zijn.
Dit werkt vrij eenvoudig doordat elke Certificate Authority (CA) zoals Let&rsquo;s Encrypt een Certificate Revocation List (CRL)
publiceert. Dit is in principe niets meer dan een lijst van certificaten die niet gewoon verlopen zijn in de tijd, maar actief
ingetrokken zijn.</p>
<p>In het geval van de klant was het probleem dus eenvoudig op te lossen door het statische R3 intermediate certificaat te vervangen
door het statische E5 certificaat. De Apache server heeft in de documentatie staan:

<blockquote class="cloudemail">
Alternatively the SSLCertificateChainFile can be the same as SSLCertificateFile when the CA certificates are directly appended to the server certificate for convinience.
</blockquote>
</p>
<p>Door nu ook deze eenvoudige aanpassing te maken is de SSLCertificateChainFile ook dynamisch geworden en gaat dit in de toekomst automatisch goed bij het vervangen van het intermediate certificate.</p></div>
        <div class="share m-2 grid grid-cols-2 lg:grid-cols-3 gap-2">
            <a href="https://twitter.com/intent/tweet?url=https%3a%2f%2ftrideeindhoven.github.io%2fwebsite%2fblog%2fletsencrypt%2f&text=Let%27s%20encrypt%20intermediate%20certificates" target="_blank"
                title="Tweet" class="share-button twitter">
                <div class="text-white text-center">
                    <span class="icon-twitter text-lg mr-2"></span>Twitter
                </div>
            </a>
            <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2ftrideeindhoven.github.io%2fwebsite%2fblog%2fletsencrypt%2f&t=Let%27s%20encrypt%20intermediate%20certificates" target="_blank"
                title="Facebook" class="share-button facebook">
                <div class="text-white text-center">
                    <span class="icon-facebook text-lg mr-2"></span>Facebook
                </div>
            </a>
            <a href="javascript:OnClickURL();" class="share-button url" title="Copy to Clipboard"
                data-clipboard-text="https://trideeindhoven.github.io/website/blog/letsencrypt/" id="url">
                <div class="text-white text-center">
                    <span class="icon-link text-lg mr-2"></span>Copy
                </div>
            </a>
        </div>
        <hr class="py-4">
        <aside id="meta">
            <div class="grid grid-cols-2">
                <div class="col-span-1">
                    
                    <a class="previous lg:text-2xl" href="https://trideeindhoven.github.io/website/blog/yealink/">
                        <div
                            class="transition-colors duration-300 border border-gray-600 hover:border-black h-auto m-3 text-center py-3 lg:py-1">
                            <span class="icon-keyboard_arrow_left"></span> Yealink publicaties
                        </div>
                    </a>
                    
                </div>
                
            </div>
        </aside>
    </div>
</div>

  </main><footer class="bg-tlgray-100">
  
  <script src='/website/js/clipboard.min.js'></script>
  <script src='/website/js/highlight.min.js'></script>
  <script src='/website/js/highlightjs-line-numbers.min.js'></script>
  <script src='/website/js/sweetalert2.min.js'></script>
  <script>
    hljs.initHighlightingOnLoad();
    hljs.initLineNumbersOnLoad();
    new ClipboardJS('.url');

    function OnClickURL() {
      Swal.fire({
        icon: 'success',
        title: 'Copied!',
        text: 'Copied the URL and title.'
      })
    }
  </script>
  
  <script>
    function toggleNav() {
      var hamburger = document.getElementById("hamburgerbtn");
      var overlay = document.getElementById("overlay");
      var body = document.body;

      hamburger.addEventListener("click", function () {
        overlay.classList.toggle("open");
        hamburger.classList.toggle("is-open");
        body.classList.toggle("scroll-lock");
      });
    }
    toggleNav();

    document.querySelector('.scroll-top').addEventListener('click', () => {
      document.documentElement.scrollTop = 0;
    });
  </script>
  
  <link href='/website/css/webfonts.min.css' rel="stylesheet" />
  
  <div class="flex items-center justify-between flex-wrap bg-gray-800 p-8 text-white">
    <div class="items-center text-xl text-grey-900 mr-6">
      CloudAware Technical Consultancy
    </div>
    <div class="w-full block flex-grow lg:flex lg:items-center lg:w-auto" id="mobileMenu">
      <div class="text-lg lg:flex-grow">
      </div>
      <div class="flex flex-row items-center text-lg">
        
        <a href="/website/privacybeleid" class="block mt-4 lg:inline-block lg:mt-0 text-gray-300 hover:text-white mr-8">
          
          Privacy statement
          
        </a>
        
        <a href="/website/cookieverklaring" class="block mt-4 lg:inline-block lg:mt-0 text-gray-300 hover:text-white mr-8">
          
          Cookieverklaring
          
        </a>
        
        <a href="/website/" class="block mt-4 lg:inline-block lg:mt-0 text-gray-300 hover:text-white mr-8">
          
          Home
          
        </a>
        
        <a href="https://github.com/gitaware" class="block mt-4 lg:inline-block lg:mt-0 text-gray-300 hover:text-white mr-8">
          
          <i class='icon-github text-2xl'></i>
          
        </a>
        
      </div>
    </div>
  </div>
  <div class="copy pl-8 py-5 bg-tlgray-700 text-white text-md">
    &copy; CloudAware Technical Consultancy 2024 All Rights Reserved.
  </div>
</footer>
</body>

</html>